import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import browser from 'webextension-polyfill';

// Import translations
const resources = {
	ru: {
		translation: {
			optimize: 'Оптимизировать',
			optimizing: 'Оптимизация...',
			saveTemplate: 'Сохранить шаблон',
			createVariable: 'Создать переменную',
			sendToChatGPT: 'Отправить в ChatGPT',
			sendToPerplexity: 'Отправить в Perplexity',
			login: 'Войти',
			logout: 'Выйти',
			register: 'Регистрация',
			history: 'История',
			templates: 'Шаблоны',
			variables: 'Переменные',
			settings: 'Настройки',
			enterPrompt: 'Введите ваш промпт здесь...',
			optimizedPrompt: 'Оптимизированный промпт',
			originalPrompt: 'Исходный промпт',
			techniquesUsed: 'Использованные техники',
			ragSources: 'Источники из базы знаний',
			promptStructure: 'Структура промпта',
			suggestedVariables: 'Предлагаемые переменные',
			role: 'Роль',
			task: 'Задача',
			context: 'Контекст',
			instructions: 'Инструкции',
			constraints: 'Ограничения',
			tone: 'Тональность',
			variableName: 'Имя переменной',
			variableDescription: 'Описание',
			defaultValue: 'Значение по умолчанию',
			save: 'Сохранить',
			cancel: 'Отмена',
			delete: 'Удалить',
			edit: 'Редактировать',
			copy: 'Копировать',
			copied: 'Скопировано!',
			error: 'Ошибка',
			success: 'Успешно',
			loading: 'Загрузка...',
			noData: 'Нет данных',
			search: 'Поиск',
			filter: 'Фильтр',
			all: 'Все',
			public: 'Публичные',
			private: 'Приватные',
			category: 'Категория',
			tags: 'Теги',
			created: 'Создано',
			updated: 'Обновлено',
			usage: 'Использований',
			login_success: 'Успешный вход',
			login_error: 'Ошибка входа',
			register_success: 'Регистрация успешна',
			register_error: 'Ошибка регистрации',
			fill_required_fields: 'Заполните обязательные поля',
			passwords_dont_match: 'Пароли не совпадают',
			username: 'Имя пользователя',
			password: 'Пароль',
			email: 'Электронная почта',
			confirm_password: 'Подтвердите пароль',
			logging_in: 'Вход...',
			auth_subtitle: 'Интеллектуальная оптимизация промптов',
			optimization_complete: 'Оптимизация завершена',
			optimization_error: 'Ошибка оптимизации',
			network_error: 'Ошибка сети. Проверьте подключение к интернету',
			server_error: 'Ошибка сервера. Попробуйте позже',
			auth_error: 'Ошибка авторизации. Войдите в систему заново',
			retry: 'Повторить',
			reset: 'Сбросить',
			logout_success: 'Выход выполнен',
			logout_error: 'Ошибка при выходе',
			close_error: 'Закрыть ошибку',
			enter_prompt_error: 'Введите промпт для оптимизации',
			edit_variable: 'Редактировать переменную',
			variable_name: 'Имя переменной',
			variable_name_help: 'Используйте только строчные буквы, цифры и подчеркивания',
			description: 'Описание',
			description_placeholder: 'Опишите для чего используется эта переменная...',
			default_value: 'Значение по умолчанию',
			default_value_placeholder: 'Введите значение по умолчанию для этой переменной...',
			no_category: 'Без категории',
			saving: 'Сохранение...',
			variable_updated: 'Переменная обновлена',
			update_error: 'Ошибка обновления',
			search_variables: 'Поиск переменных...',
			all_categories: 'Все категории',
			no_variables_found: 'Переменные не найдены',
			no_variables: 'Нет переменных',
			try_different_search: 'Попробуйте другой поиск',
			create_first_variable: 'Создайте первую переменную',
			syntax: 'Синтаксис',
			copy_syntax: 'Копировать синтаксис',
			use_variable: 'Использовать переменную',
			uncategorized: 'Без категории',
			variable_deleted: 'Переменная удалена',
			delete_error: 'Ошибка удаления',
			variable_applied: 'Переменная применена',
			variable_syntax_copied: 'Синтаксис переменной скопирован',
		},
	},
	en: {
		translation: {
			optimize: 'Optimize',
			optimizing: 'Optimizing...',
			saveTemplate: 'Save Template',
			createVariable: 'Create Variable',
			sendToChatGPT: 'Send to ChatGPT',
			sendToPerplexity: 'Send to Perplexity',
			login: 'Login',
			logout: 'Logout',
			register: 'Register',
			history: 'History',
			templates: 'Templates',
			variables: 'Variables',
			settings: 'Settings',
			enterPrompt: 'Enter your prompt here...',
			optimizedPrompt: 'Optimized Prompt',
			originalPrompt: 'Original Prompt',
			techniquesUsed: 'Techniques Used',
			ragSources: 'Knowledge Base Sources',
			promptStructure: 'Prompt Structure',
			suggestedVariables: 'Suggested Variables',
			role: 'Role',
			task: 'Task',
			context: 'Context',
			instructions: 'Instructions',
			constraints: 'Constraints',
			tone: 'Tone',
			variableName: 'Variable Name',
			variableDescription: 'Description',
			defaultValue: 'Default Value',
			save: 'Save',
			cancel: 'Cancel',
			delete: 'Delete',
			edit: 'Edit',
			copy: 'Copy',
			copied: 'Copied!',
			error: 'Error',
			success: 'Success',
			loading: 'Loading...',
			noData: 'No data',
			search: 'Search',
			filter: 'Filter',
			all: 'All',
			public: 'Public',
			private: 'Private',
			category: 'Category',
			tags: 'Tags',
			created: 'Created',
			updated: 'Updated',
			usage: 'Usage',
			login_success: 'Login successful',
			login_error: 'Login error',
			register_success: 'Registration successful',
			register_error: 'Registration error',
			fill_required_fields: 'Fill required fields',
			passwords_dont_match: 'Passwords don\'t match',
			username: 'Username',
			password: 'Password',
			email: 'Email',
			confirm_password: 'Confirm password',
			logging_in: 'Logging in...',
			auth_subtitle: 'Intelligent prompt optimization',
			optimization_complete: 'Optimization complete',
			optimization_error: 'Optimization error',
			network_error: 'Network error. Check your internet connection',
			server_error: 'Server error. Please try again later',
			auth_error: 'Authentication error. Please login again',
			retry: 'Retry',
			reset: 'Reset',
			logout_success: 'Logged out successfully',
			logout_error: 'Logout error',
			close_error: 'Close error',
			enter_prompt_error: 'Enter a prompt for optimization',
			edit_variable: 'Edit Variable',
			variable_name: 'Variable Name',
			variable_name_help: 'Use lowercase letters, numbers and underscores only',
			description: 'Description',
			description_placeholder: 'Describe what this variable is used for...',
			default_value: 'Default Value',
			default_value_placeholder: 'Enter the default value for this variable...',
			no_category: 'No Category',
			saving: 'Saving...',
			variable_updated: 'Variable updated',
			update_error: 'Update error',
			search_variables: 'Search variables...',
			all_categories: 'All Categories',
			no_variables_found: 'No variables found',
			no_variables: 'No variables',
			try_different_search: 'Try a different search',
			create_first_variable: 'Create your first variable',
			syntax: 'Syntax',
			copy_syntax: 'Copy syntax',
			use_variable: 'Use Variable',
			uncategorized: 'Uncategorized',
			variable_deleted: 'Variable deleted',
			delete_error: 'Delete error',
			variable_applied: 'Variable applied',
			variable_syntax_copied: 'Variable syntax copied',
		},
	},
};

// Initialize i18n
i18n
	.use(initReactI18next)
	.init({
		resources,
		lng: 'ru', // Default language
		fallbackLng: 'en',
		interpolation: {
			escapeValue: false, // React already escapes values
		},
		react: {
			useSuspense: false,
		},
	});

// Detect browser language
const detectLanguage = async () => {
	try {
		// Try to get from storage first
		const result = await browser.storage.local.get('language');
		if (result['language']) {
			return result['language'];
		}

		// Fallback to browser language
		const browserLang = navigator.language.toLowerCase();
		if (browserLang.startsWith('ru')) {
			return 'ru';
		}
		return 'en';
	} catch {
		return 'ru';
	}
};

// Set initial language
detectLanguage().then((lang) => {
	i18n.changeLanguage(lang);
});

export default i18n; 